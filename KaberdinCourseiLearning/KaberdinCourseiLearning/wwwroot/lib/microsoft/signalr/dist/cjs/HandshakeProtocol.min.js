"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var TextMessageFormat_1=require("./TextMessageFormat"),Utils_1=require("./Utils"),HandshakeProtocol=function(){function n(){}return n.prototype.writeHandshakeRequest=function(n){return TextMessageFormat_1.TextMessageFormat.write(JSON.stringify(n))},n.prototype.parseHandshakeResponse=function(n){var s,f,e,r,u,i,t,h,o;if(Utils_1.isArrayBuffer(n)||typeof Buffer!="undefined"&&n instanceof Buffer){if(r=new Uint8Array(n),i=r.indexOf(TextMessageFormat_1.TextMessageFormat.RecordSeparatorCode),i===-1)throw new Error("Message is incomplete.");t=i+1;f=String.fromCharCode.apply(null,r.slice(0,t));e=r.byteLength>t?r.slice(t).buffer:null}else{if(u=n,i=u.indexOf(TextMessageFormat_1.TextMessageFormat.RecordSeparator),i===-1)throw new Error("Message is incomplete.");t=i+1;f=u.substring(0,t);e=u.length>t?u.substring(t):null}if(h=TextMessageFormat_1.TextMessageFormat.parse(f),o=JSON.parse(h[0]),o.type)throw new Error("Expected a handshake response from the server.");return s=o,[e,s]},n}();exports.HandshakeProtocol=HandshakeProtocol;