function initHandlers(){$("#ItemAdd").on("click",addItemFieldInput);$("#SubmitBtn").on("click",prepareRequest);$("[name='deleteColumnBtn']").on("click",deleteColumn);$("[name='deleteOptionBtn']").on("click",deleteOption);$("[name='AddOptionBtn']").on("click",addOption);$("[name='ColumnType']").on("change",typeChange)}function addItemFieldInput(){let t=$("#Items"),i=$("#clonableItem"),n=i.clone();removePlaceHolders(n);connectEventHandlers(n);t.append(n);n.show(300)}function removePlaceHolders(n){n.removeAttr("id");n.find("[name='PlaceholderName']").attr("name","ColumnName");n.find("[name='PlaceholderAllowedValue']").attr("name","AllowedValue");n.find("[name='PlaceholderType']").attr("name","ColumnType");n.find("[name='PlaceholderDeleteBtn']").attr("name","deleteColumnBtn");n.find("[name='PlaceholderOptionDeleteBtn']").attr("name","deleteOptionBtn");n.find("[name='PlaceholderAddOptionBtn']").attr("name","AddOptionBtn")}function connectEventHandlers(n){n.find("[name='ColumnType']").on("change",typeChange);n.find("[name='deleteColumnBtn']").on("click",deleteColumn);n.find("[name='deleteOptionBtn']").on("click",deleteOption);n.find("[name='AddOptionBtn']").on("click",addOption)}function prepareRequest(){initBasicData();let n=$("#PageUserName");n.length!=0&&sendCreateRequest(n.val());collectionID!=undefined&&sendEditRequest()}function initBasicData(){collectionID=$("#CollectionID").val();name=$("#Name").val();description=$("#Description").val();theme=$("#Theme").val()}function getColumns(n=0){let t=[],i=$("[name='ColumnType']"),r=$("[name='ColumnName']");return i.each(function(i,u){let f=r.get(i);f=$(f).val();let e=$(u).closest("[name='Item']").attr("id");e==undefined&&(e=0);let o=$(u).val(),s={ColumnID:+e,CollectionID:+n,Collection:null,TypeID:+o,Type:null,ColumnName:f};t.push(s)}),t}function sendCreateRequest(n){columns=getColumns();let t={name:name,description:description,theme:+theme,columns:columns,pageUserName:n};sendRequest(t,"Create")}function sendEditRequest(){columns=getColumns(collectionID);let n={name:name,description:description,theme:+theme,columns:columns,collectionID:+collectionID,deletedColumns:deletedColumns};sendRequest(n,"Edit")}function sendRequest(n,t){let i=JSON.stringify(n);$.ajax({method:"post",contentType:"application/json",url:"/Collection/Manage/"+t,data:i,headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},success:function(n){if(n.successful){url=n.url;collectionID=/[?|&](?:id|collectionID)=(\w*)/.exec(url)[1];dropzoneObject.files.length==0&&(location.href=location.origin+url);dropzoneObject.processQueue()}}})}function deleteColumn(){let i=$(this),n=i.closest("[name='Item']"),t=n.attr("id");t!=undefined&&deletedColumns.push(t);n.hide(300,function(){n.remove()})}function deleteOption(){let r=$(this),n=r.closest("[name='AllowedValueContainer']"),t=n.siblings(),i=t.length;t.each(function(){$(this).is(":animated")&&i--});i>1?n.hide(300,function(){n.remove();reloadNumeration(t)}):($("#NoOptionsError").show(300),setTimeout(function(){$("#NoOptionsError").hide(300)},3e3))}function reloadNumeration(n){n.each(function(n){let i=$(this).find("label"),t=i.html(),r=t.length;t=t.slice(0,r-1);i.html(t+(n+1))})}function addOption(){let i=$(this).closest("[name='AllowedValues']"),r=$("#clonableOption"),n=r.clone();removeOptionPlaceholders(n);n.find("[name='deleteOptionBtn']").on("click",deleteOption);let t=n.find("label"),u=t.html();t.html(u+" #"+i.children().length);n.attr("name","AllowedValueContainer");n.insertBefore($(this).parent());n.show(300)}function removeOptionPlaceholders(n){n.removeAttr("id");n.find("[name='PlaceholderAllowedValue']").attr("name","AllowedValue");n.find("[name='PlaceholderOptionDeleteBtn']").attr("name","deleteOptionBtn")}function typeChange(){let t=$(this).children(),i=t.filter(":selected"),n=$(this).parent().parent().siblings("[name='AllowedValues']");i.val()==6?n.show(300):n.hide(300)}var url,name,description,theme,columns,collectionID,deletedColumns=[],dropzoneObject;Dropzone.autoDiscover=!1;$("#backgroundImageDz").dropzone({autoProcessQueue:!1,method:"post",ParallelUploads:100,maxFiles:1,maxFilesize:8,url:location.origin+"/Collection/Manage/UpdateImage",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},paramName:"file",acceptedFiles:"image/*",dictDefaultMessage:dropzoneLocale.dictDefaultMessage,dictCancelUpload:dropzoneLocale.dictCancelUpload,dictCancelUploadConfirmation:dropzoneLocale.dictCancelUploadConfirmation,dictFallbackMessage:dropzoneLocale.dictFallbackMessage,dictFallbackText:dropzoneLocale.dictFallbackText,dictFileTooBig:dropzoneLocale.dictFileTooBig,dictInvalidFileType:dropzoneLocale.dictInvalidFileType,dictMaxFilesExceeded:dropzoneLocale.dictMaxFilesExceeded,dictRemoveFile:dropzoneLocale.dictRemoveFile,dictResponseError:dropzoneLocale.dictResponseError,init:function(){dropzoneObject=this},success:function(){location.href=location.origin+url},sending:function(n,t,i){i.append("collectionID",collectionID)}});initHandlers();