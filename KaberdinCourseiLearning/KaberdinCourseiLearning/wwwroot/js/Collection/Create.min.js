function addItemFieldInput(){let t=$("#Items"),i=$("#clonableItem"),n=i.clone();n.removeClass("d-none");n.removeAttr("id");n.find("[name='PlaceholderName']").attr("name","ColumnName");n.find("[name='PlaceholderType']").attr("name","ColumnType");n.find("[name='PlaceholderDeleteBtn']").attr("name","deleteColumnBtn").on("click",deleteColumn);t.append(n)}function prepareRequest(){let n=$("#PageUserName");collectionID=$("#CollectionID").val();name=$("#Name").val();description=$("#Description").val();theme=$("#Theme").val();n.length!=0&&sendCreateRequest(n.val());collectionID!=undefined&&sendEditRequest()}function getColumns(n=0){let t=[],i=$("[name='ColumnType']"),r=$("[name='ColumnName']");return i.each(function(i,u){let f=r.get(i);f=$(f).val();let e=$(u).closest("[name='Item']").attr("id");e==undefined&&(e=0);let o=$(u).val(),s={ColumnID:+e,CollectionID:+n,Collection:null,TypeID:+o,Type:null,ColumnName:f};t.push(s)}),t}function sendCreateRequest(n){columns=getColumns();let t={name:name,description:description,theme:+theme,columns:columns,pageUserName:n};sendRequest(t,"CreateCollection")}function sendEditRequest(){columns=getColumns(collectionID);let n={name:name,description:description,theme:+theme,columns:columns,collectionID:+collectionID,deletedColumns:deletedColumns};sendRequest(n,"EditCollection")}function sendRequest(n,t){let i=JSON.stringify(n);$.ajax({method:"post",contentType:"application/json",url:"/Collection/Create?handler="+t,data:i,headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},success:function(n){if(n.successful){url=n.url;collectionID=/[?|&](?:id|collectionID)=(\w*)/.exec(url)[1];dropzoneObject.files.length==0&&(location.href=location.origin+url);dropzoneObject.processQueue()}}})}function deleteColumn(){let i=$(this),n=i.closest("[name='Item']"),t=n.attr("id");t!=undefined&&deletedColumns.push(t);n.remove()}var url,name,description,theme,columns,collectionID,deletedColumns=[],dropzoneObject;Dropzone.autoDiscover=!1;$("#backgroundImageDz").dropzone({autoProcessQueue:!1,method:"post",ParallelUploads:100,maxFiles:1,maxFilesize:8,url:location.origin+"/Collection/Create?handler=UpdateImage",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},paramName:"file",acceptedFiles:"image/*",init:function(){dropzoneObject=this},success:function(){location.href=location.origin+url},sending:function(n,t,i){i.append("collectionID",collectionID)}});$("#ItemAdd").on("click",addItemFieldInput);$("#SubmitBtn").on("click",prepareRequest);$("[name='deleteColumnBtn']").on("click",deleteColumn);